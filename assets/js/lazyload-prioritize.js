document.addEventListener("DOMContentLoaded",()=>{console.log("スクリプト開始: lazyload-prioritize.js");let l=document.querySelectorAll("img[loading='lazy']"),o=document.querySelectorAll("img:not([loading='lazy'])"),e=0;function t(){console.log(`読み込まれた通常画像数: ${e} / ${o.length}`),e===o.length&&(console.log("すべての通常画像が読み込まれました！Lazy画像の優先読み込みを開始します。"),n())}function n(){if(0===l.length){console.log("Lazy画像がありません。処理を終了します。");return}let o=[];l.forEach(l=>{let e=l.getBoundingClientRect(),t=Math.abs(e.top);o.push({img:l,distance:t})}),o.sort((l,o)=>l.distance-o.distance),o.forEach(({img:l},o)=>{setTimeout(()=>{console.log(`優先読み込み開始: ${l.src}`),l.removeAttribute("loading"),l.src=l.src},100*o)})}console.log(`通常画像の数: ${o.length}`),console.log(`Lazy画像の数: ${l.length}`),o.forEach(l=>{l.complete?(console.log(`すでに読み込まれている画像: ${l.src}`),e++):(l.onload=()=>{e++,console.log(`読み込み完了: ${l.src}`),t()},l.onerror=()=>{console.warn(`読み込み失敗: ${l.src}`),e++,t()})}),t()});